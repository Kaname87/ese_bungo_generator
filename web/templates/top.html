{% extends 'base.html' %}

{% block title %}{{fake_quote.original_quote.text}}{% endblock %}


{% block content %}
  <div class="fake">
    <div class="author-wrapper">
      {% if prev_fake_quote_id is not none %}
        <a class="page-controller prev-next" href={{ url_for('show_fake_quote', fake_quote_id=prev_fake_quote_id)}}>前</a>
      {% else %}
        <div class="page-controller"></div>
      {% endif %}

      <!-- </div> -->
      <div class="fake-author hide" id="fake_author_profile">
        <image
          id="fake_author_profile_image"
          class="profile"
          src=""
          alt="エセ文豪近影"
          data-profile-image-idx="{{ profile_image_idx }}"
        />
      </div>
      {% if next_fake_quote_id is not none %}
        <a class="page-controller prev-next" href={{ url_for('show_fake_quote', fake_quote_id=next_fake_quote_id)}}>次</a>
      {% else %}
        <div class="page-controller"></div>
      {% endif %}
    </div>

    <div class="novel">
      <p class="fake-quote">{{ fake_quote.text }}</p>
      <p class="fake-cite">
        <a href={{ url_for('list_fake_books', fake_author_name=fake_quote.fake_book.fake_author.name) }}>{{ fake_quote.fake_book.fake_author.name }}</a>『{{ fake_quote.fake_book.title }}』
      </p>
    </div>
  </div>
  <div class="original">
    <blockquote>
      <a class="original-quote" href=" {{url_for('list_fake_quotes_by_quote', quote_id=fake_quote.original_quote.id)}}">
        {{ fake_quote.original_quote.text }}
      </a>

      <!-- <p id="original-quote">{{ fake_quote.original_quote.text }}</p> -->

      <cite class="original-cite">
        <a href={{ url_for('list_all_fake_books', author_name=fake_quote.original_quote.book.author.name) }}>
          {{ fake_quote.original_quote.book.author.name }}
        </a>
        <a href={{ url_for('list_quotes_by_book' ,book_id=fake_quote.original_quote.book.id) }}>『{{fake_quote.original_quote.book.title}}』</a>
      </cite>
    </blockquote>
  </div>

  <section>
    <h4>その他の原作</h4>
    <div class="original-book-list">
        {% for author in authors %}
            <div class="original-book">
              <p class="author">
                  <a href={{ url_for('list_all_fake_books' ,author_name=author.name) }}>{{author.name}}</a>
              </p>
              <ul>
                  {% for book in author.books %}
                  <li>
                      <a href={{ url_for('list_quotes_by_book' ,book_id=book.id) }}>『{{book.title}}』</a>
                  </li>
                  {% endfor %}
                  {% if author.book_count > 3 %}
                    <li class="have-more">他</li>
                  {% endif %}
              </ul>
            </div>
        {% endfor %}
        </div>

    <a class="" href={{ url_for('list_authors') }}>原作一覧</a>
　</section>

<section style="font-size: 0.7rem; margin: 30px 10%; padding-bottom: 30px; color:#7c4657; border:0.5px solid #7c4657;">
    <h4>序文</h4>
      文豪の作品の名文を元に生成された名文集です。<br>
      文章中に使用された名詞に類似する名詞をランダムに置き換えることで文章を生成しています。
      <br>
      <br>
    単語の類似度の判定はWord2Vecを使用し、モデルには東北大学 乾・岡崎研究室の<a href="http://www.cl.ecei.tohoku.ac.jp/~m-suzuki/jawiki_vector/">学習済みモデル</a>を使用しています。
    生成元の作品は全て青空文庫から引用しています。
  </section>
{% endblock %}

{% block script %}

<!--
<script>
document.addEventListener("DOMContentLoaded", function() {
  var profileImageList = [
    'hayashi.jpg',
    'fuyume.jpg',
    'akutako.jpg',
  ];
  var imageDirPath = '/static/image/bungo/';

  var profileImageElm = document.getElementById('fake_author_profile_image');


  // Listner
  profileImageElm.addEventListener('click', function(event) {
    var target = event.target;
    var newIdx = parseInt(target.dataset.profileImageIdx) + 1;
    if (newIdx > profileImageList.length-1) {
      newIdx = 0;
    }
    target.dataset.profileImageIdx = newIdx;
    event.target.src = imageDirPath + profileImageList[newIdx]
  });

  profileImageElm.addEventListener('load', function(event) {
    document.getElementById('fake_author_profile').classList.remove('hide');
  });

  // Set profile image index
  document.getElementById('twitter_share').addEventListener('click', function(event) {
    event.target.href += encodeURIComponent(
      '?profile=' + profileImageElm.dataset.profileImageIdx
    );
  });

  var prevNextList = document.getElementsByClassName('prev-next')
  for (var i = 0; i < prevNextList.length; i++) {
    prevNextList[i].addEventListener('click', function (event) {
      event.target.href += ('?profile=' + profileImageElm.dataset.profileImageIdx)
    });
  }
  document.getElementById('service_name').addEventListener('click', function(event) {
    event.target.href += ('?profile=' + profileImageElm.dataset.profileImageIdx)
  });

  function initProfile() {
    var initIdx = (
        isNaN(profileImageElm.dataset.profileImageIdx) || (profileImageElm.dataset.profileImageIdx > profileImageList.length -1)
      )
      ? 0
      : profileImageElm.dataset.profileImageIdx;
    var initImage = profileImageList[initIdx];

    profileImageElm.dataset.profileImageIdx = initIdx;
    profileImageElm.src = imageDirPath + initImage;
  }

  initProfile();
});
</script> -->
{% endblock %}
